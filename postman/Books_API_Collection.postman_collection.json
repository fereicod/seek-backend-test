{
	"info": {
		"_postman_id": "books-api-seek-backend",
		"name": "Books API - SEEK Backend Test",
		"description": "Colección completa para probar la API de libros con autenticación JWT.\n\n## Cómo usar:\n1. Primero ejecuta **Login** para obtener el token\n2. El token se guarda automáticamente en la variable `access_token`\n3. El resto de endpoints usan ese token automáticamente",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{"key": "base_url", "value": "http://localhost:8000", "type": "string"},
		{"key": "access_token", "value": "", "type": "string"},
		{"key": "book_id", "value": "", "type": "string"}
	],
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.collectionVariables.set('access_token', response.access_token);",
									"}",
									"pm.test('Status 200', () => pm.response.to.have.status(200));",
									"pm.test('Has token', () => pm.expect(pm.response.json()).to.have.property('access_token'));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"admin@test.com\",\n    \"password\": \"adminpass\"\n}"
						},
						"url": {"raw": "{{base_url}}/api/v1/auth/login", "host": ["{{base_url}}"], "path": ["api", "v1", "auth", "login"]}
					}
				}
			]
		},
		{
			"name": "Books",
			"item": [
				{
					"name": "List Books (Paginated)",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has items', () => pm.expect(pm.response.json()).to.have.property('items'));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/v1/books?page=1&size=10",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "books"],
							"query": [{"key": "page", "value": "1"}, {"key": "size", "value": "10"}]
						}
					}
				},
				{
					"name": "List Books (Sorted)",
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/v1/books?page=1&size=10&sort_by=price&sort_order=desc",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "books"],
							"query": [{"key": "page", "value": "1"}, {"key": "size", "value": "10"}, {"key": "sort_by", "value": "price"}, {"key": "sort_order", "value": "desc"}]
						}
					}
				},
				{
					"name": "List Books (Filtered)",
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/v1/books?page=1&size=10&author=Martin&genre=Software",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "books"],
							"query": [{"key": "page", "value": "1"}, {"key": "size", "value": "10"}, {"key": "author", "value": "Martin"}, {"key": "genre", "value": "Software"}]
						}
					}
				},
				{
					"name": "Get Book by ID",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has id', () => pm.expect(pm.response.json()).to.have.property('id'));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {"raw": "{{base_url}}/api/v1/books/{{book_id}}", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "{{book_id}}"]}
					}
				},
				{
					"name": "Create Book",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "if (pm.response.code === 200) { pm.collectionVariables.set('book_id', pm.response.json().book.id); }"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"title\": \"The Pragmatic Programmer\",\n    \"author\": \"David Thomas, Andrew Hunt\",\n    \"published_date\": \"2019-09-13T00:00:00\",\n    \"genre\": \"Software Engineering\",\n    \"price\": 49.99\n}"
						},
						"url": {"raw": "{{base_url}}/api/v1/books", "host": ["{{base_url}}"], "path": ["api", "v1", "books"]}
					}
				},
				{
					"name": "Update Book (PUT)",
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "PUT",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"title\": \"The Pragmatic Programmer (20th Anniversary)\",\n    \"author\": \"David Thomas, Andrew Hunt\",\n    \"published_date\": \"2019-09-13T00:00:00\",\n    \"genre\": \"Software Engineering\",\n    \"price\": 54.99\n}"
						},
						"url": {"raw": "{{base_url}}/api/v1/books/{{book_id}}", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "{{book_id}}"]}
					}
				},
				{
					"name": "Patch Book (PATCH)",
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "PATCH",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {"mode": "raw", "raw": "{\n    \"price\": 59.99\n}"},
						"url": {"raw": "{{base_url}}/api/v1/books/{{book_id}}", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "{{book_id}}"]}
					}
				},
				{
					"name": "Delete Book",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "DELETE",
						"url": {"raw": "{{base_url}}/api/v1/books/{{book_id}}", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "{{book_id}}"]}
					}
				}
			]
		},
		{
			"name": "Stats",
			"item": [
				{
					"name": "Average Price by Year (All)",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));", "pm.test('Has data', () => pm.expect(pm.response.json()).to.have.property('data'));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {"raw": "{{base_url}}/api/v1/books/stats/average-price-by-year", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "stats", "average-price-by-year"]}
					}
				},
				{
					"name": "Average Price by Year (Specific)",
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/v1/books/stats/average-price-by-year?year=2023",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "books", "stats", "average-price-by-year"],
							"query": [{"key": "year", "value": "2023"}]
						}
					}
				}
			]
		},
		{
			"name": "Error Cases",
			"item": [
				{
					"name": "Unauthorized (No Token)",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 401 or 403', () => pm.expect([401, 403]).to.include(pm.response.code));"], "type": "text/javascript"}}],
					"request": {"auth": {"type": "noauth"}, "method": "GET", "url": {"raw": "{{base_url}}/api/v1/books", "host": ["{{base_url}}"], "path": ["api", "v1", "books"]}}
				},
				{
					"name": "Book Not Found",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 404', () => pm.response.to.have.status(404));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "GET",
						"url": {"raw": "{{base_url}}/api/v1/books/000000000000000000000000", "host": ["{{base_url}}"], "path": ["api", "v1", "books", "000000000000000000000000"]}
					}
				},
				{
					"name": "Invalid Book Data (422)",
					"event": [{"listen": "test", "script": {"exec": ["pm.test('Status 422', () => pm.response.to.have.status(422));"], "type": "text/javascript"}}],
					"request": {
						"auth": {"type": "bearer", "bearer": [{"key": "token", "value": "{{access_token}}", "type": "string"}]},
						"method": "POST",
						"header": [{"key": "Content-Type", "value": "application/json"}],
						"body": {"mode": "raw", "raw": "{\n    \"title\": \"Incomplete Book\"\n}"},
						"url": {"raw": "{{base_url}}/api/v1/books", "host": ["{{base_url}}"], "path": ["api", "v1", "books"]}
					}
				}
			]
		}
	]
}
